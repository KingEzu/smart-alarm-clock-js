<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Modern Clock with Alarm</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>

  <div style="display: flex; flex-direction: row; gap: 30px; flex-wrap: wrap; justify-content: center;">
    <div>
      <div id="clock">
        <h2>The Time Is Now</h2>
        <div id="time">
          <div><span id="hour">00</span><span>Hours</span></div>
          <div><span id="minutes">00</span><span>Minutes</span></div>
          <div><span id="seconds">00</span><span>Seconds</span></div>
          <div><span id="ampm">AM</span><span></span></div>
        </div>
      </div>

      <div id="alarm">
        <h3>Set Alarm</h3>
        <div id="alarm-controls">
          <select id="alarm-hour"></select>
          <select id="alarm-minute"></select>
          <select id="alarm-ampm">
            <option>AM</option>
            <option>PM</option>
          </select>
          <button onclick="setAlarm()">Set Alarm</button>
        </div>
        <button id="stop-btn" onclick="stopAlarm()">Stop Alarm</button>
        <p id="alarm-status"></p>
      </div>
    </div>

    <div id="saved-alarms">
      <h4>Saved Alarms</h4>
      <hr>
      <ul id="alarm-list"></ul>
    </div>
  </div>

  <audio id="alarm-sound" src="./asstes/alarm.mp3" preload="auto"></audio>

  <script>
    const hours = document.getElementById('hour');
    const minutes = document.getElementById('minutes');
    const seconds = document.getElementById('seconds');
    const ampm = document.getElementById('ampm');
    const alarmStatus = document.getElementById('alarm-status');
    const stopBtn = document.getElementById('stop-btn');
    const alarmSound = document.getElementById('alarm-sound');
    const alarmList = document.getElementById('alarm-list');

    let savedAlarms = JSON.parse(localStorage.getItem('alarms')) || [];
    let alarmTriggered = false;
    let currentRingingAlarm = null;

    renderSavedAlarms();

    function updateClock() {
      const now = new Date();
      let h = now.getHours();
      let m = now.getMinutes();
      let s = now.getSeconds();
      let period = h >= 12 ? 'PM' : 'AM';

      if (h === 0) h = 12;
      else if (h > 12) h -= 12;

      const hh = String(h).padStart(2, '0');
      const mm = String(m).padStart(2, '0');
      const ss = String(s).padStart(2, '0');

      hours.textContent = hh;
      minutes.textContent = mm;
      seconds.textContent = ss;
      ampm.textContent = period;

      const currentTime = `${hh}:${mm} ${period}`;
      if (savedAlarms.includes(currentTime) && !alarmTriggered) {
        alarmTriggered = true;
        currentRingingAlarm = currentTime;
        alarmSound.loop = true;
        alarmSound.play();
        stopBtn.style.display = 'inline-block';
        alarmStatus.textContent = "üîî Alarm ringing!";
      }
    }

    function populateTimeOptions(selectHour = 'alarm-hour', selectMinute = 'alarm-minute') {
      const hourSelect = document.getElementById(selectHour);
      const minuteSelect = document.getElementById(selectMinute);
      hourSelect.innerHTML = '';
      minuteSelect.innerHTML = '';
      for (let i = 1; i <= 12; i++) {
        hourSelect.innerHTML += `<option value="${String(i).padStart(2, '0')}">${String(i).padStart(2, '0')}</option>`;
      }
      for (let i = 0; i < 60; i++) {
        minuteSelect.innerHTML += `<option value="${String(i).padStart(2, '0')}">${String(i).padStart(2, '0')}</option>`;
      }
    }

    function setAlarm() {
      const h = document.getElementById('alarm-hour').value;
      const m = document.getElementById('alarm-minute').value;
      const period = document.getElementById('alarm-ampm').value;
      const time = `${h}:${m} ${period}`;

      if (h && m && period) {
        if (savedAlarms.length < 5 && !savedAlarms.includes(time)) {
          savedAlarms.push(time);
          localStorage.setItem('alarms', JSON.stringify(savedAlarms));
          alarmStatus.textContent = `‚úÖ Alarm set for ${time}`;
          alarmTriggered = false;
          stopBtn.style.display = 'none';
          renderSavedAlarms();
        } else {
          alarmStatus.textContent = "‚ö†Ô∏è Alarm list full or already exists.";
        }
      } else {
        alarmStatus.textContent = "‚ö†Ô∏è Please select valid time.";
      }
    }

    function renderSavedAlarms() {
      alarmList.innerHTML = '';
      savedAlarms.forEach((time, index) => {
        const li = document.createElement('li');
        li.innerHTML = `
          ${index + 1}. ${time}
          <span style="float:right;">
            <button onclick="editAlarm(${index})" style="margin-left:5px;">‚úèÔ∏è</button>
            <button onclick="deleteAlarm(${index})">üóëÔ∏è</button>
          </span>
        `;
        alarmList.appendChild(li);
      });
    }

    function deleteAlarm(index) {
      savedAlarms.splice(index, 1);
      localStorage.setItem('alarms', JSON.stringify(savedAlarms));
      renderSavedAlarms();
      alarmStatus.textContent = "‚õî Alarm deleted.";
    }

    function editAlarm(index) {
      const current = savedAlarms[index];
      const [timePart, period] = current.split(' ');
      const [h, m] = timePart.split(':');

      const li = document.createElement('li');
      li.innerHTML = `
        ${index + 1}.
        <select id="edit-hour-${index}"></select> :
        <select id="edit-minute-${index}"></select>
        <select id="edit-ampm-${index}">
          <option ${period === 'AM' ? 'selected' : ''}>AM</option>
          <option ${period === 'PM' ? 'selected' : ''}>PM</option>
        </select>
        <button onclick="saveEdit(${index})">üíæ</button>
        <button onclick="renderSavedAlarms()">‚ùå</button>
      `;

      alarmList.replaceChild(li, alarmList.children[index]);

      populateTimeOptions(`edit-hour-${index}`, `edit-minute-${index}`);
      document.getElementById(`edit-hour-${index}`).value = h;
      document.getElementById(`edit-minute-${index}`).value = m;
    }

    function saveEdit(index) {
      const h = document.getElementById(`edit-hour-${index}`).value;
      const m = document.getElementById(`edit-minute-${index}`).value;
      const period = document.getElementById(`edit-ampm-${index}`).value;
      const time = `${h}:${m} ${period}`;

      if (!savedAlarms.includes(time)) {
        savedAlarms[index] = time;
        localStorage.setItem('alarms', JSON.stringify(savedAlarms));
        renderSavedAlarms();
        alarmStatus.textContent = `‚úèÔ∏è Alarm updated to ${time}`;
      } else {
        alarmStatus.textContent = "‚ö†Ô∏è This alarm already exists.";
      }
    }

    function stopAlarm() {
      alarmSound.pause();
      alarmSound.currentTime = 0;
      alarmTriggered = false;
      alarmStatus.textContent = "Alarm stopped.";
      stopBtn.style.display = 'none';

      if (currentRingingAlarm) {
        const index = savedAlarms.indexOf(currentRingingAlarm);
        if (index !== -1) {
          savedAlarms.splice(index, 1);
          localStorage.setItem('alarms', JSON.stringify(savedAlarms));
          renderSavedAlarms();
        }
        currentRingingAlarm = null;
      }
    }

    populateTimeOptions();
    setInterval(updateClock, 1000);
  </script>

</body>
</html>
